
<html>
	<head>
		<link href="assets/css/style.css" rel="stylesheet">

    <link href="assets/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text&display=swap" rel="stylesheet">
		<script src="assets/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<meta charset="utf-8">
		<link href="https://fonts.googleapis.com/css?family=Satisfy&display=swap" rel="stylesheet">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="https://fonts.googleapis.com/css?family=Tangerine&display=swap" rel="stylesheet">
		<title>Rhaya & Ashane</title>
	</head>
	<body style="margin: 0 0 0 0; font-family: 'Crimson Text', serif; backgroud-color:#F2F0ED" width="100%">
    <a href="index.html">
  		<div class="titleName">
      Rhaya & Ashane
    </div>
  </a>
		<center><div style="height: 35px; width: 100%; background:#813467; ">
			<table align="center" width=80% style="max-width: 700px; " border=0>
				<tr>
					<!-- <td width=33% align="right"><h5><a href='wedding.html' style="color: #6b6b6b; text-decoration: underline;">wedding</a></h5></td> -->
					<!-- <td>home</td> -->
					<!-- <td style="padding-top: 7px; color: grey; text-decoration: none;"><a href="index.html">welcome</a></td> -->
					<td style="padding-top: 8px; width:16.6%; text-align:center"><a href="wedding.html" class="tablink">Wedding Program</a></td>
					<td style="padding-top: 8px; width:16.6%; text-align:center"><a href="rsvp.html" class="tablink">RSVP</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="accom.html" class="tablink">Accomodation</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="info.html" class="tablink">Info</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="live.html" class="tablink">Livestream</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="guestb.html" class="tablink">Guestbook</a></td>
				</tr>
			</table>
		</div></center>


  <center>
    <br /><br /><br />
    <div id="empty"></div>
    <div id="guester"></div>
    <div id="loading"></div>
    <div class="container-fluid" id="rsvpsec" style="width: 95%;">
      <div class="container-fluid">
        <div class="row">
          <div id="poruwa" style=" max-width: 350px;display:none"><br><br>
            <div
            style="background: #957e4e; color:white; border-radius:25px; padding: 5 10 10 10; margin: -10px;">
            <h2>Poruwa</h2>
            <h3>26 | 03 | 2020</h3>
            at half past nine in the morning
            <br><br>
            JETWING ST ANDREWS HOTEL<br>
            NUWARA ELIYA<br><Br>

              <div id="rPorConfirm" style="display:none">
                <i>Thanks for confirming.</i><br><br>
              </div>
              <div id="formPorLoader" style="display: none;"><BR><BR><img src='assets/goldspinner.gif' height=50 /><BR><BR><BR><BR></div>

                <form id="porFormMain" action="javascript:rPorSubmit();">
                  <div id="porForm" style="width: 90%; display:none">
                    <div id="idLoader"></div>
                    <div id="porListDisp"></div>
                    <Br><button class="btn btn-primary btn-block" type="submit"
                      style="width:70%;background-color: white !important; color:#957e4e; border:none">SUBMIT</button>
                    </div>
                  </form>
                </div><br>
                <a href="nuwara.html"  style="color:grey; font-size: 1.2em; text-decoration: underline;">Click here for information on <br>hotel stays and more</a>
              </div>


            </div>
          </div>
        </div>
        <!-- </div> -->
        <br><Br><br><Br>
          <p class="text-center" style="color:#c4758e ">
            Made with <i class="glyphicon glyphicon-heart"></i><br /><a href="http://www.weddingsbysonali.com/">Weddings By Sonali</a>
          </p>
          <br />
        </center>
        <script>
        var truthStore = {
          id: 0,
          imehendi: 0,
          cur: -1,
          found: []
        };
        var idata = {};
        var firebaseConfig = {
          apiKey: "AIzaSyAxKWsLczr45ola3XmEmCnti_Bl5o_eVPc",
          authDomain: "wbs-rush-adn.firebaseapp.com",
          databaseURL: "https://wbs-rush-adn.firebaseio.com",
          projectId: "wbs-rush-adn",
          storageBucket: "wbs-rush-adn.appspot.com",
          messagingSenderId: "92680720757",
          appId: "1:92680720757:web:51bef5e02ca41bfc03033c"
        };
        document.getElementById("loading").innerHTML = "<br><BR><img src='assets/spinner.gif' height=50 />";


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const db = firebase.firestore();
        const url = window.location; // http://google.com?id=test
        const urlObject = new URL(url);
        const id = parseInt(urlObject.searchParams.get("id"));

        console.log("ID is: " + id);

        db.collection("guest")
        .where("id", "==", id)
        .get()
        .then(function (querySnapshot) {
          if (querySnapshot.empty == true) {
            console.log("It's empty");
            // document.getElementById("empty").innerHTML = "<a href=\"w">";
            // window.location.replace("http://www.w3schools.com");
            // window.location.replace("http://www.weddingsbysonali.com/rushanka-adnan/");
            // TO DO LAVAN CHANGE HERE
          }

          querySnapshot.forEach(function (doc) {
            document.getElementById("loading").style.display = "none";
            document.getElementById("guester").innerHTML = "<h4>" + doc.data().inviteName.trim() +
            ", <br>your presence is warmly welcomed.</h2> ";
            console.log("test");
            document.getElementById("poruwa").style.display = "block";


            idata = {
              por: parseInt(doc.data().iporuwa),
              iPorList: doc.data().iPorList,
            };

            if (!doc.data().didPorSubmit) {
              document.getElementById("porForm").style.display = "block";
              document.getElementById("idLoader").innerHTML = "<input name='id' type='hidden' value='"+id+"'>";
              for (i = 0; i < idata.por; i++) {
                console.log("Invite name: " + doc.data().inviteName);
                document.getElementById("porListDisp").innerHTML +=
                "   <div style='border:2px solid #b09e7a; border-radius: 10px;margin-top: 5px; padding-top: 5px; padding-bottom: 5px;'><span style='font-size:1.3em;'>" +
                doc.data().iPorList[i] +
                "</span><br><div class='row' style='width:98%; margin-top:5px'><div class='form-check col-xs-6'><input class='form-check-input' type='radio' name='poruwa" +
                i +
                "' value='1' required><label class='form-check-label' for='inlineRadio2'><span style='font-weight:normal;'>Will attend</span></label></div><div class='form-check col-xs-6'><input class='form-check-input' type='radio' name='poruwa" +
                i +
                "' value='-1' required><label class='form-check-label' for='inlineRadio2'><span style='font-weight:normal;'>Will not attend</span></label></div></div>";
              }
            } else {
              console.log("Already submitted - Poruwa");
              document.getElementById("rPorConfirm").style.display = "block";

            }




          });

        })
        .catch(function (error) {
          console.log("Error getting documents: ", error);
        });



        function rPorSubmit() {
          document.getElementById("formPorLoader").style.display = "block";
          document.getElementById("porForm").style.display = "none";
          console.log("Woha" + idata.por);
          var porname = [];
          count = 0;
          for (i = 0; i < idata.por; i++) {
            var rporv = document.querySelector('input[name="poruwa' + i + '"]:checked').value;
            if (rporv == 1) {
              porname.push(idata.iPorList[i]);
              count++;
              console.log("Added poruwa " + idata.iPorList[i]);
            }
          }
          testers = {
            rPorList: porname,
            rPor: count,
            didPorSubmit: true
          }
          db.collection("guest").doc(urlObject.searchParams.get("id")).update(testers).then(function () {
            console.log("Document successfully updated - Poruwa!");
            document.getElementById("formPorLoader").style.display = "none";
            document.getElementById("rPorConfirm").style.display = "block";
          }).catch(function(error){
            console.error("Error writing document Poruwa: ", error);
          });

        };


        </script>
      </body>
      <html>

      </html>

      </html>
