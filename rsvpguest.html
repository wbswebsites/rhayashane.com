

<html>
<head>
  <link href="assets/css/style.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link href="assets/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <link href="https://fonts.googleapis.com/css?family=Crimson+Text&display=swap" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Satisfy&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Tangerine&display=swap" rel="stylesheet">

	<script src="https://www.gstatic.com/firebasejs/7.5.2/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.5.2/firebase-firestore.js"></script>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>


		<title>Rhaya & Ashane</title>
	</head>
	<body style="margin: 0 0 0 0; font-family: 'Crimson Text', serif; background-color:#FAF7F2" width="100%">
    <a href="index.html">
  		<div class="titleName">
      Rhaya & Ashane
    </div>
  </a>
		<center><div style="height: 35px; width: 100%; background:#813467; ">
			<table align="center" width=80% style="max-width: 700px; " border=0>
				<tr>
					<!-- <td width=33% align="right"><h5><a href='wedding.html' style="color: #6b6b6b; text-decoration: underline;">wedding</a></h5></td> -->
					<!-- <td>home</td> -->
					<!-- <td style="padding-top: 7px; color: grey; text-decoration: none;"><a href="index.html">welcome</a></td> -->
					<td style="padding-top: 8px; width:16.6%; text-align:center"><a href="wedding.html" class="tablink">Wedding Program</a></td>
					<td style="padding-top: 8px; width:16.6%; text-align:center"><a href="rsvp.html" class="tablink">RSVP</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="accom.html" class="tablink">Accomodation</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="info.html" class="tablink">Info</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="live.html" class="tablink">Livestream</a></td>
          <td style="padding-top: 8px; width:16.6%; text-align:center"><a href="guestb.html" class="tablink">Guestbook</a></td>
				</tr>
			</table>
		</div></center>


  <center>
    <br /><br /><br />
    <div id="empty"></div>
    <div id="guester"></div>
    <div id="loading"></div>
    <div class="container-fluid" id="rsvpsec" style="width: 95%;">
      <div class="container-fluid">
        <div class="row">
          <center>
          <div id="poruwa" style=" max-width: 500px; display:none"><br><br>
            <div
            style="padding: 5 10 10 10; margin: -10px;">
            <h1 style="font-family: Playfair Display;">WEDDING CEREMONY</h2>

            <span style="font-family: Garamond;font-size: 16px;">ROCK VILLA, BENTOTA</span><br>

  <span style="font-family: Garamond;font-size: 20px;">09.04.2021</span><br>
<br><br>

              <div id="rPorConfirm" style="display:none">
                <i>Thanks for confirming.</i><br><br>
              </div>
              <div id="formPorLoader" style="display: none;"><BR><BR><img src='assets/goldspinner.gif' height=50 /><BR><BR><BR><BR></div>

                <form id="porFormMain" action="javascript:rPorSubmit();">
                  <div id="porForm" style="width: 90%; display:none">
                    <div id="idLoader"></div>
                    <div id="porListDisp" style=""></div>
                    <Br><button class="btn btn-primary btn-block" type="submit"
                      style="width:70%;background-color: white !important; color:#957e4e; border:none">SUBMIT</button>
                    </div>
                  </form>
                </div><br>
              </div>

</center>
            </div>
          </div>
        </div>
        <!-- </div> -->
        <br><Br><br><Br>
          <p class="text-center" style="color:#c4758e ">
            Made with <i class="glyphicon glyphicon-heart"></i><br /><a href="http://www.weddingsbysonali.com/">Weddings By Sonali</a>
          </p>
          <br />
        </center>
        <script>
        var truthStore = {
          id: 0,
          imehendi: 0,
          cur: -1,
          found: []
        };
        var idata = {};
        var firebaseConfig = {
          apiKey: "AIzaSyAxKWsLczr45ola3XmEmCnti_Bl5o_eVPc",
          authDomain: "wbs-rush-adn.firebaseapp.com",
          databaseURL: "https://wbs-rush-adn.firebaseio.com",
          projectId: "wbs-rush-adn",
          storageBucket: "wbs-rush-adn.appspot.com",
          messagingSenderId: "92680720757",
          appId: "1:92680720757:web:51bef5e02ca41bfc03033c"
        };
        document.getElementById("loading").innerHTML = "<br><BR><img src='assets/spinner.gif' height=50 />";


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const db = firebase.firestore();
        const url = window.location; // http://google.com?id=test
        const urlObject = new URL(url);
        const id = parseInt(urlObject.searchParams.get("id"));

        console.log("ID is: " + id);

        db.collection("guestrhaya")
        .where("id", "==", id)
        .get()
        .then(function (querySnapshot) {
          if (querySnapshot.empty == true) {
            console.log("It's empty");
            // document.getElementById("empty").innerHTML = "<a href=\"w">";
            // window.location.replace("http://www.w3schools.com");
            // window.location.replace("http://www.weddingsbysonali.com/rushanka-adnan/");
            // TO DO LAVAN CHANGE HERE
          }

          querySnapshot.forEach(function (doc) {
            document.getElementById("loading").style.display = "none";
            document.getElementById("guester").innerHTML = "<h4>" + doc.data().inviteName.trim() +
            ", <br>your presence is warmly welcomed.</h2> ";
            console.log("test");
            document.getElementById("poruwa").style.display = "block";


            idata = {
              por: parseInt(doc.data().iporuwa),
              iPorList: doc.data().iPorList,
            };

            if (!doc.data().didPorSubmit) {
              document.getElementById("porForm").style.display = "block";
              document.getElementById("idLoader").innerHTML = "<input name='id' type='hidden' value='"+id+"'>";
              for (i = 0; i < idata.por; i++) {
                console.log("Invite name: " + doc.data().inviteName);
                document.getElementById("porListDisp").innerHTML +=
                "   <div style='border:2px solid rgb(0,0,0,0.1); border-radius: 10px; margin-top: 5px;padding-left: 10px; padding-top: 5px; padding-bottom: 5px;'><div style='margin:10px;'><span style='font-size:1.3em;'>" +
                doc.data().iPorList[i] +
                "</span><br><div class='row' style='width:70%; margin-top:5px'><div class='form-check col-xs-6' style='text-align:left'><input class='form-check-input' type='radio' name='poruwa" +
                i +
                "' value='1' required><label class='form-check-label' for='inlineRadio2'><span style='font-weight:normal;'>Will attend</span></label></div><div class='form-check col-xs-6' style='text-align:left'><input class='form-check-input' type='radio' name='poruwa" +
                i +
                "' value='-1' required><label class='form-check-label' for='inlineRadio2'><span style='font-weight:normal;'>Will not attend</span></label></div><br><textarea class='form-control' id='pordiet"+i+"' placeholder='Please enter any dietary requirements here.' rows='3'></textarea></div></div>";
              }
            } else {
              console.log("Already submitted - Poruwa");
              document.getElementById("rPorConfirm").style.display = "block";

            }




          });

        })
        .catch(function (error) {
          console.log("Error getting documents: ", error);
        });



        function rPorSubmit() {
          document.getElementById("formPorLoader").style.display = "block";
          document.getElementById("porForm").style.display = "none";
          console.log("Woha" + idata.por);
          var porname = [];
          var pordiet=[];
          count = 0;
          for (i = 0; i < idata.por; i++) {
            var rporv = document.querySelector('input[name="poruwa' + i + '"]:checked').value;
            var rdiet= document.getElementById('pordiet'+i).value
            if (rporv == 1) {
              porname.push(idata.iPorList[i]);
              pordiet.push(rdiet)
              count++;
              console.log("Added poruwa " + idata.iPorList[i]);
            }
          }
          testers = {
            rPorList: porname,
            rPor: count,
            didPorSubmit: true,
            rPorDiet: pordiet
          }
          db.collection("guestrhaya").doc(urlObject.searchParams.get("id")).update(testers).then(function () {
            console.log("Document successfully updated - Poruwa!");
            document.getElementById("formPorLoader").style.display = "none";
            document.getElementById("rPorConfirm").style.display = "block";
          }).catch(function(error){
            console.error("Error writing document Poruwa: ", error);
          });

        };


        </script>
      </body>
      <html>

      </html>

      </html>
